В распределенной системе невозможно одновременно обеспечить полное выполнение всех трех принципов: согласованности, доступности и устойчивости к разделению. То есть, при наличии разделения сети между узлами, система должна выбирать между согласованностью и доступностью.

**[[Согласованность]] (Consistency):** Фундаментальный принцип, который требует, чтобы все копии данных в системе имели одинаковую информацию в любой момент времени. В контексте распределенных систем это означает, что независимо от того, какой узел системы обрабатывает запрос, результат будет всегда согласован с остальными частями системы. Это обеспечивает предсказуемость и согласованность данных.

**[[Доступность]] (Availability):** Доступность – это способность системы отвечать на запросы пользователей в любое время, даже при наличии сбоев или неполадок в системе. Она позволяет поддерживать работоспособность приложений даже при ограниченной доступности ресурсов. 

**[[Устойчивость]] к разделению (Partition Tolerance):** Устойчивость к разделению – это способность системы продолжать работу даже при потере связи между отдельными компонентами. Распределенные системы могут столкнуться с сетевыми сбоями или разделением на части из-за проблем с сетью. Устойчивость к разделению гарантирует, что система будет продолжать функционировать, сохраняя при этом согласованность и доступность в пределах возможного.

Именно баланс между согласованностью, доступностью и устойчивостью определяет, как система будет реагировать на разнообразные ситуации и какие компромиссы будут сделаны в её архитектуре.

Применение [[CAP теорема]](как выбрать баланс):
1. **Анализ требований проекта:** Первый шаг – понимание требований и характеристик вашей системы.
2. **Оценка последствий:** Продумайте последствия, связанные с выбором одного из принципов.
3. **Коммуникация с заказчиком:** Вовлечение заказчика или заинтересованных сторон в процесс выбора баланса может помочь определить, что для них является наиболее важным и приемлемым.

**Советы по оптимизации систем:**
- **Кэширование:** Используйте кэширование, чтобы улучшить доступность данных. Однако, помните, что это может повлиять на согласованность.
    
- **Асинхронные операции:** Переносите некритические операции в асинхронные процессы, чтобы уменьшить нагрузку на основной поток системы.
    
- **Репликация и шардинг:** Распределите данные между разными узлами и реплицируйте их, чтобы обеспечить доступность и устойчивость.
    
- **Гибридные решения:** В некоторых случаях можно использовать гибридные подходы, выбирая разные принципы для разных компонентов системы.

## Комбинации CAP
**CA-системы (Согласованность + Доступность)**
Жертвуют устойчивостью к разделению
Подходят для систем где сетевые разделения маловероятны

**CP-системы (Согласованность + Устойчивость к разделению)**
Жертвуют доступностью
Гарантируют согласованность даже при сетевых разделениях

**AP-системы (Доступность + Устойчивость к разделению)**
Жертвуют согласованностью
Обеспечивают ответ всегда, даже с возможными conflicts

## Практические компромиссы при проектировании
**Когда выбирать CP:**
- Финансовые системы
- Системы бронирования
- Медицинские записи

Цена: Временная недоступность при сетевых проблемах

**Когда выбирать AP:**
- Социальные сети
- Системы рекомендаций
- Кэширование контента

Цена: Возможная несогласованность (conflict resolution)

**Когда выбирать CA:**
- Системы с гарантированной сетевой инфраструктурой
- Локальные приложения

Цена: Уязвимость к сетевым разделениям